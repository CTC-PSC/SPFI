---
title: "Computing a SPFI and SPFI-derived FPA file"
date: "Last updated on October 8, 2018"
output:
  word_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
library(knitr)
```

```{r include=FALSE}
source("Code/SPFItoFPAfun.R")
```

# SPFI to FPA Inputs
## Program flow
Note the following order of operations:
1. Read in HRJ data
2. Create a SPFI Input Object
  a. Stock and ages to include in the index
  b. Catch time series by SPFI fishery strata
  c. ERA fisheries that are to be used to compute SPFI
  d. Define the SPFI fishery strata
3. Read in model fishery definitions
4. Read in STK file (depends on 2)
5. Read in MDL files (depends on 3)

![](C:/zWork/ctc-psc/SPFI/Report/SPFIandSPFItoFPDataNeeds.jpg)

## HRJ Data
The SPFI is computed using output from the CTC's exploitation rate analysis program CoShak12. The core data needed for SPFI computations are saved in what are called HRJ files. Data from HRJ files can be obtained in one of two ways: from a HRJ database or from the list of HRJ files used to create the HRJ database. For this example I will use the latter, but note that both options are available.

```{r include=TRUE, eval=FALSE}
#Read in HRJ files in a directory
 by=readHRJdir("Data/HRJ/2018", nFisheries=79, straysinescap=TRUE, Age6="include")
#Convert to CY layout
 cy=convertHRJ_BYtoCY(by)
#Convert HRJ from R to Access format
 z.cy=convertHRJ_RtoAccess(cy)
#add the 'preferred' table to the Access format
 z.cy = addPTableHRJ(z.cy, hrjclass = "Access")
```

```{r include=FALSE}
load("Data/Phase2/2018ERA_HRJforBPC.RData")
```

## SPFI
SPFI output.

## Model fishery definitions
File contains just the names of the model fisheries. Note that fishery names can't have spaces in it because fishery names are used to reference. You will need this file prior to reading in the STK file.

## STK
STK file as generated by the base period calibration program.

## MDL
MDL files as generated from CoShak4 and/or summarized MDL recovery data both in terms of the SPFI-fishery strata.
